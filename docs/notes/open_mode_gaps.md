# 开放数据验收遗留问题（2025-11-22）

> 来源：在 WSL 终端执行 `./deployment/launcher/start_open_wallboard.sh` 启动后，人工观察 `rolling-screen.html` 的表现并总结。

## 1. 指数/场景数据缺失
- **欧洲区块无数据**：`rolling-screen.js` 的 `REGION_GROUPS.europe` 期望 `SX5E.GI`、`UKX.GI`、`CAC.GI`、`DAX.GI`，但 `OpenProvider.fetch_indices` 当前只映射美股/亚太指数；需为欧洲指数补充 Stooq 代码或其他来源。
- **A 股相关指标缺口**：`indices` 中仅有上证/深证/沪深300等，heatmap 也只涵盖指数，缺少早期 PRD 中提到的行业/板块数据。
- ~~**A 股短线资金聚焦仍引用指数**（2025-11-22 WSL 验收）：`page-short` 模块缺乏独立的板块/资金流数据源，导致“强势/弱势/热点板块”依旧显示指数级别的热力信息，需要单独的数据接口（如行业涨跌/北向资金等）。~~
- **A 股短线资金支撑**（2025-11-22 update）：`OpenProvider` 现已串联东财行业板块涨跌与净流入数据，`rolling-screen` 的“短线资金”页改为消费 `a_share_short_term` 快照（包含强势/弱势/资金榜）。后续可在此基础上追加北向分市场、龙头个股等更丰富的资金视角。
- **全球指数/大宗行情更新**（2025-11-22）：为避免 Stooq 的日线延迟导致指数落后数月，`OpenProvider` 新增腾讯行情接口获取上证/深证/恒生/美股三大指数及主流美股个股，并用同源的 `hf_*` 合约填充原油、贵金属、铜、天然气等商品价格。Stooq 仅保留在欧洲指数缺省时的兜底。
- **商品行情纠偏**（2025-11-22）：在腾讯 `hf_*` 数据长期异常的情况下，引入 AlphaVantage 月频即时行情（WTI/Brent/Copper/NatGas），保证页面显示的油气/金属价格不再倒挂。
- （2025-11-23）东财板块接口改为“直连优先 + r.jina.ai 兜底”并修复 JSON 解析，确保 VPN 白名单环境仍可拿到 `a_share_short_term` 板块与资金榜；商品行情合并逻辑改为按时间新鲜度选择来源，避免过时的 AlphaVantage 月频覆盖较新数据。
- （2025-11-23 人工复核）东财行业榜数据已正常，请勿改动；但大宗商品页的油气/金属报价与真实市场明显偏离，需重新甄别开放数据源或添加延迟/来源标注。
- （2025-XX-XX）商品行情已切换为单一 Yahoo 期货源（WTI/布油/天然气/金银/铜/铂/钯/农产品/咖啡等），不再混用 Tencent/FRED/AlphaVantage，前端名称与分组已同步修正。

## 2. 场景混杂 / UX 偏差
- M2 迁移时将七个页面集中在 `rolling-screen.html`，但 A 股资金、全球视角、新闻条等内容互相交织，和 `FinanceRollingScreenProject` 中定义的场景顺序不一致，易让用户混淆。
- 现有布局主要是自研样式，并未对照 `FrontendDesign/FintechRollingScreen.html` 完整移植，因此在玻璃态卡片、动效、字体等方面与视觉稿差异较大。

## 3. 债券/利率可视化不足
- `/data/latest` 已含 FRED 系列（UST10Y/2Y、SOFR、SONIA、EFFR），但前端仅以列表形式呈现，缺少曲线或仪表盘式的展示，难以一眼判断期限结构。
- （2025-11-23）中国国债收益率切换为财政部/中国债券信息网（chinabond）公布的曲线页面，经 `r.jina.ai` 代理抓取 1Y/3Y/5Y/10Y，当日时间戳，LPR 不再展示以避免硬编码。
- （2025-11-23 人工复核）前一版东财字段映射存在期限错位；现已按 chinabond 页面的期限标签解析并回填对应代码，手工校对通过。若 chinabond 不可达可酌情补东财/其他备源。
- （2025-11-23）前端“债券与宏观”页新增中美收益率曲线火花线展示，初步展现期限结构；后续可考虑增添更多期限/曲线平滑与标注。

## 4. 宏观事件倒计时缺失（已解决）
- （2025-11-22）后台改用 FXStreet 公共日历并缓存未来 15 条事件，倒计时组件获取真实的最近事件时间，避免出现“11/22 仍显示 11/17 事件”的现象。
- （2025-11-23 人工复核）事件源已调整为 Nasdaq 优先（7 日窗口），FXStreet / ForexFactory / TradingEconomics 兜底，倒计时正常落在未来窗口，真实性问题暂告解除。

## 5. 记录与下一步
- 以上问题已加入 `TODO.md > M5` 任务列表；短期需：
  1. 扩展 `OpenProvider` 的欧洲指数和 A 股板块数据，并提供 fallback。
  2. 重构 `rolling-screen.js` 的场景划分，使其与 PRD/视觉稿对齐。
  3. 设计利率/固收的可视化组件。
  4. 实现事件倒计时逻辑，确保 `countdown` DOM 更新。
  5. 针对商品与利率的开放源重新甄别与标注，确保报价与真实市场一致或明确告知延迟。当前验收显示：COMEX 白银实测应为 -1.27% 但接口返回不符，`change`/`change_pct` 口径需校验（区分日/月涨幅）；利率字段需确认使用到期收益率而非票面或价格。2025-11-23 再验收：商品（贵金属/能源）与利率输出仍与实盘明显偏离，需更换或修正数据源/字段映射。

负责同事在动手前可先围绕该笔记更新设计方案或原型，再拆解为具体开发任务。
